# 城市大脑天擎平台

## 简介

&emsp;据说是一个比较大的项目，主要是我主管的老板负责的，感觉级别蛮高的。虽然我是归在我主管下面，但还是被调过去完成相关需求。

&emsp;主体的代码是我主管的老板写的，据他自己说，他不是前端出身的，半路出家学了一下。用的是 react + typescript 技术栈，具体的代码情况的话， react 完整的页面数据通信是没有的，简单的 props 传递一下，或者直接从 window 上取。 路由的话， window.loacation.href 结合 react-router-dom 一起使用。

&emsp;首先，主要是登陆注册页面，这个登陆成功之后是通过 window.loacation.href 实现页面跳转。然后跳入到一个模板中，左边是模块目录，选择之后出现对应的主题内容。这方面的路由是 react-router-dom 实现。开发的话，其实就是为这个模板不断添加模块目录和对应的内容。

&emsp;我参与的工作如下:

1. 修复现有问题
2. 将[人工智能标注](https://github.com/officialBusiness/resume/blob/main/2/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E6%A0%87%E6%B3%A8.md)中的图像标注操作添加到其中。

## 修复现有问题

&emsp;具体情况如下: 

1. 比较简单的一类问题，就是将 cookie 中的一段信息，添加到 axios 的 header 中。值得一提的是，虽然用了 axios ，但是并没有使用拦截对请求信息进行统一，有些是单独的进行请求，有些是使用装饰器进行请求(看情况我主管的老板大概是边学边做的)，需要分别的添加。还有一个就是 websocket 的 header 添加，抄了一下[作业](https://stackoverflow.com/questions/4361173/http-headers-in-websockets-client-api)发现，由于 websocket 自带的局限性，只能在固定的属性上添加，所以让后台配合的改了一下代码。

2. 一个很简单的变量检查，因为没有考虑 undefined 类型的情况，所以会导致页面崩溃，判断一下即可。这里感觉 typescript 是白给了。

3. 一些 css 的简单修改，涉及到组件自适应和 ui 的展示性。这个就更无语了，页面坍塌、内部节点宽高使用 vw 和 vh 、直接固定像素，不考虑自适应。也是长见识了。最后是麻木了，效果实现就行。

4. ant-design 的 select 组件的问题。官方案例就在那，照着写就行的事，都会有莫名其妙的问题，列表滚动的时候出现列表数据错乱，真的是。

5. xterms 的命令行现实问题，网上抄了一下作业发现需要和后代的终端进行同步，让后代同步改一下相应的代码。

6. 有一个是人工智能对话的页面，调用 react-chat-elements 组件显示对话，修复不能自动到底的问题(覆盖了一下原来组件的 css)；需要修改用户输入问题的 ui；原来是固定的三个聊天记录，改成一开始一个，然后可以增删，最多三个，最少一个，要求自适应。比较没想法的是，使用 useRef 保存的机器人对象。原来的代码将聊天信息机器人和接口写到一个组件内部，需要用 useRef 拿到机器人聊天对话组件内的函数，输入用户的问题，对聊天信息进行更新。但是这样的话，就不方便对其进行增加了( useRef 好像只能一开始在组件内就确定好，想要调用函数创建编译报错了)。最后我也在这个基础上进行骚操作，还是一开始就有三个 useRef ， useState 新建了两个数组，一个用于保存现在展示的组件，一个用于保存没展示的，增删其实就是将三个 useRef 在这两个数组中进行转移，效果是实现了，没什么问题。(说实在的，比较好的方法应该是将聊天机器的对象从组件内抽离，直接写成一个对象，而不是和组件绑在一起。不过这样麻烦，要对原来的代码进行比较大的修改。而这个修复是有时间要求的，就两三个小时的样子，而且毕竟是我的主管的老板的代码，还是不要乱动比较好)

7. 原本的平台名称好像是叫地雀，后来改成了天擎，其中有一些表格的组件(二次封装了 ant-design 的 table 组件)以及相关的变量名开头就是 dq/Dq ，后来全部都要改成 tq/Tq。虽然没什么问题，全文件夹大小写区分搜索替换的时候注意一下就行，但就是有点无语。(感觉这种组件级别的，应该是没必要加项目名前缀吧)

8. 还有一些简单的增删改查的小需求添加以及优化。

&emsp;修复问题的时候，有感觉上的不适应，毕竟很难想象大厂部门级的项目还能这样，不过也没什么实质上的麻烦障碍。真正比较头痛的是，修复问题的同时，还要照顾菜鸡的想法，用符合菜鸡认知的代码写法修复问题。就是从这里开始有离职的打算了

&emsp;有多菜呢，有一个问题修复的时候，我新添加了 useEffect 去监听一个参数。然后提交代码审评之后，我主管的老板就问我，新添加和原来的，两个 useEffect 执行顺序怎么样。一开始我还真没理解为什么问这个，我理解的 useEffect 的主要意义就是初始化和监听。后来扯了一会，我主管的老板甚至截了张问 chatGPT 是否能出现两个 useEffect 的图在群里，最后还说后面我可以试着给他更简单、清晰、专业的回答。我在整个对话结束了之后，回味了半天才意识到，他其实就是没懂 useEffect 的作用。这里是真的没想到，半路出家是半路到这种程度。虽然说使用 react 没必要完全掌握所有的 react 信息，但是 useEffect 都在项目中使用了，还是半懂不懂的程度，真的是让人想不到。

&emsp;扯得有稍微点多了，主要就是简单解释一下为什么打算离职的根本原因。直接原因的话，就是之后我在一个线上会议日程中点了拒绝，给的理由就是早上太早了，想要再迟点。(其实就是有点想离职，不想去了)。之后也没说什么，几天后直接来了人传话，沟通了一下，他那边觉得我态度不好，就不想要我了(毕竟外包嘛，签合同的是博彦不是阿里)，我也正好顺水推舟直接提交离职流程了。

&emsp;在离职的这个阶段，再度加深了认识。这个时候，我是在集成图像标注操作到主项目中，然后他那边就简单派了个人问一下进度怎么样就结束了。之前干脆利落的不想要我了也就算了，但是离职了都没人来做代码交接为后续工作做准备。要是一个普通小公司的话能理解，大厂的话，总觉得不是很符合大厂的水平。感觉是对自己的项目都这么随便，不负责任，真的是，太菜了一点。前端是半桶水，管理也是半桶水。

## 集成图像标注操作

&emsp;因为是自己写的代码，所以集成没什么大的问题。简单说一些需要注意的吧。

1. 使用的是原来的后台接口，由于不同的接口，所以使用 axios.create ，创建一个实例进行区分，单独拦截接口信息。但是登陆接口没统一，所以先直接使用固定的账号密码进行了登录，保存用户信息。用户信息过期的话，就使用 reload 刷新页面，重新登陆。

2. css 上的问题。将模块嵌入的时候发现页面和原来的不一致，结果发现有的 css 样式被覆盖了，最后在子模块下再次进行 css 样式覆盖。还有图标展示的问题，我习惯是直接导入 iconfont 的 css 实现字体图标，但是主项目上的图标是直接使用 ant-design 的现成图标，最后是仿照原来 vue 项目使用 background-image 加载图片显示图标。还有一个是我个人的习惯问题，我一般习惯于在 body 上定义 font-size=100px， 然后下面的 css 尺寸使用 rem ，(这个是为了方便在不同尺寸的屏幕上实现自适应，源于我第一家公司的智慧城市类大屏项目)，主项目的尺寸是 px ，就得改一下，实现统一。(基本就是 css 的使用规范不统一引起的问题。有些是主项目的 css 确实不行；有些是因为就是我在写人工智能标注的时候，没注意到这个情况)

3. 由于主项目是没有 store 的，所以单独的在模块上添加 Provider 组件，实现模块内部的页面数据通信。

## 小结

&emsp;这是一个根基不完善，但是勉强满足了能用就行的前端项目(也亏的很多地方只是显示表格、增删改查数据之类的基本操作)。不过从前端代码来看，不说的话，真的不确定会是部门级的项目。

&emsp;体会了一个集成各类模块的项目，虽然不是很好，但是可以反过来思考，想要构建好的话需要做什么。

&emsp;体会了什么是不好的管理，由此对于管理有一些思考。管理能力差的人，会给人一种矛盾分裂的感觉。类似于一个人，说是要向前走，但行为确实在向后退。意识不到自己的行为会产生什么影响，不知道想要达到自己的目标应该做什么。

&emsp;虽然说有上司和下属之分，但其实大家都是实现需求中的一部分，每个人要在流程中做好自己要做的事。只是上司一般相对于下属更具有主动权。而管理很糟糕的上司，使用不好自己的主动权，会对整个流程形成一种阻碍，妨碍到别人。而大多数这种情况下，这类上司是不自知的。
